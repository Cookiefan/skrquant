import tushare as ts
import pandas as pds
from tqdm import tqdm
code300 = ['600000', '600004', '600009', '600010', '600011', '600015', '600016', '600018', '600019', '600023', '600025', '600027', '600028', '600029', '600030', '600031', '600036', '600038', '600048', '600050', '600061', '600066', '600068', '600085', '600089', '600100', '600104', '600109', '600111', '600115', '600118', '600153', '600157', '600170', '600176', '600177', '600188', '600196', '600208', '600219', '600221', '600233', '600271', '600276', '600297', '600309', '600332', '600339', '600340', '600346', '600352', '600362', '600369', '600372', '600383', '600390', '600398', '600406', '600415', '600436', '600438', '600482', '600487', '600489', '600498', '600516', '600518', '600519', '600522', '600535', '600547', '600549', '600566', '600570', '600583', '600585', '600588', '600606', '600637', '600660', '600674', '600688', '600690', '600703', '600704', '600705', '600739', '600741', '600760', '600795', '600809', '600816', '600837', '600867', '600886', '600887', '600893', '600900', '600909', '600919', '600926', '600958', '600977', '600998', '600999', '601006', '601009', '601012', '601018', '601021', '601066', '601088', '601108', '601111', '601117', '601138', '601155', '601166', '601169', '601186', '601198', '601211', '601212', '601216', '601225', '601228', '601229', '601238', '601288', '601318', '601328', '601333', '601336', '601360', '601377', '601390', '601398', '601555', '601600', '601601', '601607', '601611', '601618', '601628', '601633', '601668', '601669', '601688', '601727', '601766', '601788', '601800', '601808', '601818', '601828', '601838', '601857', '601877', '601878', '601881', '601888', '601898', '601899', '601901', '601919', '601933', '601939', '601985', '601988', '601989', '601991', '601992', '601997', '601998', '603156', '603160', '603259', '603260', '603288', '603799', '603833', '603858', '603986', '603993', '000001', '000002', '000063', '000069', '000100', '000157', '000166', '000333', '000338', '000402', '000408', '000413', '000415', '000423', '000425', '000503', '000538', '000553', '000568', '000625', '000627', '000630', '000651', '000661', '000671', '000703', '000709', '000725', '000728', '000768', '000776', '000783', '000786', '000792', '000826', '000839', '000858', '000876', '000895', '000898', '000938', '000959', '000961', '000963', '000983', '001965', '001979', '002001', '002007', '002008', '002024', '002027', '002032', '002044', '002050', '002065', '002081', '002085', '002120', '002142', '002146', '002153', '002179', '002202', '002230', '002236', '002241', '002252', '002271', '002294', '002304', '002310', '002311', '002352', '002411', '002415', '002422', '002450', '002456', '002460', '002466', '002468', '002475', '002493', '002508', '002555', '002558', '002572', '002594', '002601', '002602', '002624', '002625', '002673', '002714', '002736', '002773', '002797', '002925', '300003', '300015', '300017', '300024', '300033', '300059', '300070', '300072', '300122', '300124', '300136', '300142', '300144', '300251', '300296', '300408', '300433']
code_cement = ['600217', '600425', '600449', '600585', '600668', '600720', '600801', '600802', '600881', '600883', '601992', '000401', '000546', '000672', '000789', '000877', '000885', '000935', '002233', '002302', '002346']
code_electronics = ['600050', '600074', '600076', '600100', '600105', '600130', '600198', '600271', '600288', '600289', '600330', '600345', '600406', '600410', '600446', '600455', '600476', '600485', '600487', '600498', '600522', '600536', '600556', '600562', '600570', '600571', '600588', '600601', '600608', '600654', '600677', '600680', '600718', '600728', '600734', '600756', '600764', '600775', '600776', '600797', '600804', '600845', '600850', '600990', '601519', '603000', '603019', '603025', '603636', '000021', '000032', '000035', '000063', '000066', '000070', '000503', '000532', '000547', '000555', '000561', '000586', '000681', '000711', '000801', '000836', '000851', '000892', '000938', '000948', '000970', '000977', '000997', '002017', '002027', '002052', '002063', '002065', '002073', '002089', '002090', '002093', '002095', '002115', '002148', '002151', '002152', '002153', '002161', '002174', '002177', '002180', '002184', '002194', '002195', '002230', '002231', '002232', '002253', '002261', '002268', '002279', '002280', '002281', '002296', '002308', '002312', '002313', '002315', '002316', '002331', '002351', '002354', '002362', '002368', '002369', '002373', '002376', '002383', '002384', '002396', '002401', '002405', '002410', '002417', '002421', '002439', '002446', '002465', '002467', '002474', '002491', '002519', '002528', '002544', '002547', '002577', '002583', '002609', '002635', '002642', '002649', '002657', '300002', '300010', '300017', '300020', '300025', '300028', '300033', '300036', '300038', '300042', '300044', '300045', '300047', '300050', '300051', '300052', '300059', '300065', '300074', '300075', '300076', '300079', '300081', '300085', '300096', '300098', '300101', '300104', '300113', '300130', '300134', '300136', '300150', '300166', '300167', '300168', '300170', '300177', '300182', '300183', '300188', '300209', '300211', '300212', '300213', '300226', '300229', '300231', '300235', '300245', '300248', '300250', '300253', '300264', '300270', '300271', '300275', '300277', '300282', '300287', '300288', '300290', '300292', '300295', '300297', '300299', '300300', '300302', '300310', '300311', '300312', '300315', '300322', '300324', '300330', '300333', '300339', '300348', '300352', '300353', '300359', '300365', '300366', '300367', '300369', '300377', '300378', '300379', '300380', '300383', '300386', '300390', '300392', '300394', '300397', '300399', '300418', '300419', '300431', '300440', '300448', '300449']
start_date = '20140901'
end_date='20190630'

def trans_data(data):
    data=data.rename(columns={'trade_date':'date', 'vol':'volume'})
    data.index = data['date']
    data.index=pds.to_datetime(data.index,format='%Y-%m-%d')
    data = data[['open','close','high','low','volume']].sort_index()
    return data


def update_hs300(pro):

    for code in tqdm(code300):
        try:
            now = pro.query('daily', ts_code=code+'.SH', start_date=start_date, end_date=end_date)
            if now.empty:
                now = pro.query('daily', ts_code=code+'.SZ', start_date=start_date, end_date=end_date)
            now = trans_data(now)
            now.to_csv('./DATA/HS300/%s.csv'%code)
        except:
            print(code)
            continue

def update_cement(pro):
    for code in tqdm(code_cement):
        try:
            # now = ts.get_hist_data(ts_code=code,start_date='20170101')[['open','close','high','low','volume']].sort_index()
            now = pro.query('daily', ts_code=code+'.SH', start_date=start_date, end_date=end_date)
            if now.empty:
                now = pro.query('daily', ts_code=code+'.SZ', start_date=start_date, end_date=end_date)
            now = trans_data(now)
            now.to_csv('./DATA/Cement/%s.csv'%code)
        except:
            print(code)
            continue

def update_electronics(pro):
    for code in tqdm(code_electronics):
        try:
            # now = ts.get_hist_data(ts_code=code,start_date='20170101')[['open','close','high','low','volume']].sort_index()
            now = pro.query('daily', ts_code=code+'.SH', start_date=start_date, end_date=end_date)
            if now.empty:
                now = pro.query('daily', ts_code=code+'.SZ', start_date=start_date, end_date=end_date)
            now = trans_data(now)
            now.to_csv('./DATA/Electronics/%s.csv'%code)
        except:
            print(code)
            continue


if __name__ == '__main__':
    # ts.set_token('9656253110d9b65fbb643b40a9c4092decb4f8c425246d8995115c39')
    pro = ts.pro_api()
    now = pro.query('index_daily', ts_code='399300.SZ', start_date=start_date, end_date=end_date)
    now = trans_data(now)
    now.to_csv('./DATA/hs300.csv')
    # update_hs300(pro)
    update_cement(pro)
    # update_electronics(pro)